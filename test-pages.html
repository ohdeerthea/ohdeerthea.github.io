<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Error Checker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-section { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .error { color: #d32f2f; }
        .success { color: #2e7d32; }
        .warning { color: #f57c00; }
    </style>
</head>
<body>
    <h1>Page Error Checker</h1>
    <div id="results"></div>
    
    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-section ${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            results.appendChild(div);
        }

        function checkPage(url, pageName) {
            return new Promise((resolve) => {
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.onload = () => {
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        const errors = [];
                        
                        // Check for script errors
                        iframe.contentWindow.onerror = (msg, file, line) => {
                            errors.push(`Script error: ${msg} at ${file}:${line}`);
                        };
                        
                        setTimeout(() => {
                            // Check if queue manager exists
                            const hasQueueManager = !!iframe.contentWindow.queueManager;
                            const hasQueueClass = !!iframe.contentWindow.CommissionQueueManager;
                            
                            log(`${pageName} loaded successfully`, 'success');
                            log(`Queue Manager instance: ${hasQueueManager ? 'YES' : 'NO'}`, hasQueueManager ? 'success' : 'warning');
                            log(`Queue Manager class: ${hasQueueClass ? 'YES' : 'NO'}`, hasQueueClass ? 'success' : 'warning');
                            
                            if (errors.length > 0) {
                                errors.forEach(error => log(`${pageName} error: ${error}`, 'error'));
                            }
                            
                            iframe.remove();
                            resolve({ hasQueueManager, hasQueueClass, errors });
                        }, 3000);
                        
                    } catch (e) {
                        log(`${pageName} access error: ${e.message}`, 'error');
                        iframe.remove();
                        resolve({ error: e.message });
                    }
                };
                
                iframe.onerror = () => {
                    log(`${pageName} failed to load`, 'error');
                    iframe.remove();
                    resolve({ error: 'Failed to load' });
                };
                
                iframe.src = url;
                document.body.appendChild(iframe);
            });
        }

        async function runTests() {
            log('Starting page tests...', 'info');
            
            const pages = [
                { url: 'debug-queue.html', name: 'Debug Queue' },
                { url: 'admin.html', name: 'Admin Panel' },
                { url: 'queue.html', name: 'Queue Page' }
            ];
            
            for (const page of pages) {
                log(`Testing ${page.name}...`, 'info');
                await checkPage(page.url, page.name);
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            log('All tests completed!', 'success');
        }

        // Start tests when page loads
        window.addEventListener('load', runTests);
    </script>
</body>
</html>
